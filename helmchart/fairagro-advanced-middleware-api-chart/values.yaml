# Default values for fairagro-advanced-middleware-api-chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

config:
  log_level: DEBUG
  # gitlab_api:
  #   group: FAIRagro-advanced-middleware-dev
  #   url: https://datahub-dev.ipk-gatersleben.de
  #   max_workers: 10
  #   commit_chunk_size: 200
  git_repo:
    url: https://datahub-dev.ipk-gatersleben.de
    group: FAIRagro-advanced-middleware-dev
    max_workers: 10
  known_rdis:
    - bonares
    - edal
    - edaphobase
    - openagrar
    - publisso
    - thunen_atlas
  celery: {}  # all further celery config is set via environment variables
  # otel_endpoint: http://signoz:4318  # Uncomment to enable Sign
  # require_client_cert: false

rabbitmq:
  enabled: true
  image: rabbitmq:3.12-management
  # auth:
  #   username: guest
  #   password: guest
  #   erlang_cookie: ""
  #   existingSecret: ""  # if set, the secret must contain keys: username, password, erlang_cookie
  service:
    port: 5672
    managementPort: 15672

redis:
  enabled: true
  image: redis:7
  # auth:
  #   password: ""
  #   existingSecret: ""  # if set, the secret must contain key: password
  service:
    port: 6379

# API deployment settings
api:
  replicaCount: 1
  image:
    repository: zalf/fairagro-advanced-middleware-api
    pullPolicy: IfNotPresent
    tag: ""
  service:
    type: ClusterIP
    port: 8000
  ingress:
    enabled: false
    className: ""
    mtlsEnabled: false
    mtlsVerifyDepth: 1
    annotations: {}
    hosts: []
    tls: []
  tls:
    # Direct certificate values (preferred for secrets management)
    serverCrt: ""  # Base64-encoded or PEM server certificate
    serverKey: ""  # Base64-encoded or PEM server private key
    caCrt: ""      # Base64-encoded or PEM CA certificate
    # File-based certificate references (used if direct values are not provided)
    serverCrtFile: ""  # Path to server certificate file (e.g., server.crt)
    serverKeyFile: ""  # Path to server key file (e.g., server.key)
    caCrtFile: ""      # Path to CA certificate file (e.g., ca.crt)
    caTlsSecretName: ""
  podAnnotations: {}
  podLabels: {}
  podSecurityContext: {}
  securityContext: {}
  livenessProbe:
    httpGet:
      path: /v1/liveness
      port: http
    initialDelaySeconds: 10    # Container darf starten
    timeoutSeconds: 3          # genug Zeit für HTTP-Request
    periodSeconds: 10
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /v1/health
      port: http
    initialDelaySeconds: 10    # Container darf starten
    timeoutSeconds: 3          # genug Zeit für HTTP-Request
    periodSeconds: 10
    failureThreshold: 3
  resources: {}
  volumes: []
  volumeMounts: []
  nodeSelector: {}
  tolerations: []
  affinity: {}
  serviceAccount:
    create: true
    automount: false
    annotations: {}
    name: ""
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80

# Celery worker settings
celery:
  # brokerUrl: ""     # use this setting if you want to override the generated RabbitMQ URL
  # resultBackend: "" # use this setting if you want to override the generated Redis URL
  image:
    repository: zalf/fairagro-advanced-middleware-api
    pullPolicy: IfNotPresent
    tag: ""
  worker:
    enabled: true
    replicaCount: 1
    concurrency: 4
    serviceAccount:
      create: true
      automount: false
      annotations: {}
      name: ""
    livenessProbe:
      exec:
        command: ["true"]
      # initialDelaySeconds: 25
      # periodSeconds: 20
      # timeoutSeconds: 30
      # failureThreshold: 3
    readinessProbe:
      exec:
        command:
          - /api/middleware-api/middleware-api
          - worker-health
      initialDelaySeconds: 10
      timeoutSeconds: 3
      periodSeconds: 10
      failureThreshold: 3
    podAnnotations: {}
    podLabels: {}
    podSecurityContext: {}
    securityContext: {}
    resources: {}
    volumes: []
    volumeMounts: []
    nodeSelector: {}
    tolerations: []
    affinity: {}
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 100
      targetCPUUtilizationPercentage: 80
      # targetMemoryUtilizationPercentage: 80

# This is for the secrets for pulling an image from a private repository more information can be found here: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
imagePullSecrets: []
# This is to override the chart name.
nameOverride: ""
fullnameOverride: ""
